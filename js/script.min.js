function initTetris(t,e,o){!function(t){var r={node:null,context:null,width:412,height:408,blockSide:23,colorFrame:"rgba(121,121,121,0.8)",colorBlocks:"rgb(192,0,15,0.6)"};r.drawBackground=function(){this.context.fillStyle="#f8f8ff",this.context.strokeStyle=e||r.colorFrame,this.context.fillRect(0,0,this.width,this.height),this.context.lineWidth=8,this.context.strokeRect(0,0,this.width,this.height),this.context.lineWidth=4,this.context.beginPath(),this.context.moveTo(256,0),this.context.lineTo(256,this.height),this.context.stroke(),this.context.closePath(),this.context.fillStyle=o||r.colorBlocks,this.context.fillText("Score:",298,75),this.context.fillText(n.score.amount,330-n.score.halfWidth,125),this.context.fillText("Next:",308,220),this.context.lineWidth=2,this.context.strokeRect(283,255,102,102),this.context.strokeStyle="#f8f8ff"},r.drawBlock=function(t,e){var o=e*(this.blockSide+2)+5,r=t*(this.blockSide+2)+5;this.context.strokeRect(o,r,this.blockSide,this.blockSide),this.context.fillRect(o,r,this.blockSide,this.blockSide)},r.drawBlocks=function(){for(var t=0;t<n.rows;t++)for(var e=0;e<n.cols;e++)n.blocks[t][e]&&this.drawBlock(t,e)},r.drawNextBlock=function(t,e){var o=e*(this.blockSide+2)+285,r=t*(this.blockSide+2)+257;this.context.strokeRect(o,r,this.blockSide,this.blockSide),this.context.fillRect(o,r,this.blockSide,this.blockSide)},r.drawNextBlocks=function(){for(var t=0;t<n.nextSide;t++)for(var e=0;e<n.nextSide;e++)i.next.tetromino[t][e]&&this.drawNextBlock(t,e)},r.drawPause=function(t){this.context.fillStyle="#f8f8ff",this.context.strokeStyle=e||r.colorFrame,this.context.fillRect(50,110,158,80),this.context.strokeRect(50,110,158,80),this.context.strokeRect(53,113,152,74),this.context.fillStyle=e||r.colorFrame,this.context.fillText(n.pauseText[t].text,130-n.pauseText[t].halfWidth,155),this.context.strokeStyle="#f8f8ff"},r.draw=function(){this.drawBackground(),this.drawBlocks(),this.drawNextBlocks()};var i={};i.current={tetromino:null,number:0,direction:0,x:0,y:0},i.next={tetromino:[[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1]],number:0,direction:0},i.collection=[[[[0,0,1,0],[0,0,1,0],[0,0,1,0],[0,0,1,0]],[[0,0,0,0],[1,1,1,1],[0,0,0,0],[0,0,0,0]],[[0,0,1,0],[0,0,1,0],[0,0,1,0],[0,0,1,0]],[[0,0,0,0],[1,1,1,1],[0,0,0,0],[0,0,0,0]]],[[[0,0,1,0],[0,0,1,0],[0,1,1,0],[0,0,0,0]],[[0,0,0,0],[0,1,0,0],[0,1,1,1],[0,0,0,0]],[[0,1,1,0],[0,1,0,0],[0,1,0,0],[0,0,0,0]],[[0,0,0,0],[0,1,1,1],[0,0,0,1],[0,0,0,0]]],[[[0,1,0,0],[0,1,0,0],[0,1,1,0],[0,0,0,0]],[[0,0,0,0],[0,0,1,0],[1,1,1,0],[0,0,0,0]],[[0,1,1,0],[0,0,1,0],[0,0,1,0],[0,0,0,0]],[[0,0,0,0],[1,1,1,0],[1,0,0,0],[0,0,0,0]]],[[[0,0,0,0],[0,1,1,0],[0,1,1,0],[0,0,0,0]],[[0,0,0,0],[0,1,1,0],[0,1,1,0],[0,0,0,0]],[[0,0,0,0],[0,1,1,0],[0,1,1,0],[0,0,0,0]],[[0,0,0,0],[0,1,1,0],[0,1,1,0],[0,0,0,0]]],[[[0,1,0,0],[0,1,1,0],[0,0,1,0],[0,0,0,0]],[[0,0,0,0],[0,0,1,1],[0,1,1,0],[0,0,0,0]],[[0,1,0,0],[0,1,1,0],[0,0,1,0],[0,0,0,0]],[[0,0,0,0],[0,0,1,1],[0,1,1,0],[0,0,0,0]]],[[[0,0,0,0],[0,1,0,0],[1,1,1,0],[0,0,0,0]],[[0,0,0,0],[0,1,0,0],[0,1,1,0],[0,1,0,0]],[[0,0,0,0],[0,0,0,0],[1,1,1,0],[0,1,0,0]],[[0,0,0,0],[0,1,0,0],[1,1,0,0],[0,1,0,0]]],[[[0,0,1,0],[0,1,1,0],[0,1,0,0],[0,0,0,0]],[[0,0,0,0],[0,1,1,0],[0,0,1,1],[0,0,0,0]],[[0,0,1,0],[0,1,1,0],[0,1,0,0],[0,0,0,0]],[[0,0,0,0],[0,1,1,0],[0,0,1,1],[0,0,0,0]]]],i.chooseNext=function(){var t=this.collection.length,e=Math.floor(Math.random()*t);e=e===t?t-1:e;var o=Math.floor(4*Math.random());o=4===o?3:o,this.current.tetromino=this.next.tetromino,this.current.number=this.next.number,this.current.direction=this.next.direction,this.current.x=n.xStart,this.current.y=n.yStart,this.next.tetromino=this.collection[e][o],this.next.number=e,this.next.direction=o,r.draw()},i.move=function(t,e){return!!this.checkPaste(t,e)&&(this.cutTetronimo(),this.current.x+=t,this.current.y+=e,this.pasteTetronimo(),r.draw(),!0)},i.rotate=function(){this.cutTetronimo();var t=this.current.direction;this.current.direction=(this.current.direction+1)%4,this.current.tetromino=this.collection[this.current.number][this.current.direction],this.checkPaste(0,0)||(this.current.direction=t,this.current.tetromino=this.collection[this.current.number][this.current.direction]),this.pasteTetronimo(!1),r.draw()},i.cutTetronimo=function(){for(var t=0;t<n.nextSide;t++){var e=this.current.y+t;if(e>=0)for(var o=0;o<n.nextSide;o++)0!==this.current.tetromino[t][o]&&(n.blocks[e][this.current.x+o]=0)}},i.checkPaste=function(t,e){for(var o=0;o<n.nextSide;o++)for(var r=this.current.y+e+o,i=e+o,s=0;s<n.nextSide;s++)if(0!==this.current.tetromino[o][s]){var c=this.current.x+t+s,a=t+s;if(c<0||c>=n.cols)return!1;if(r>=n.rows)return!1;if(r>=0&&n.blocks[r][c]){if(!(a>=0&&a<n.nextSide&&i<n.nextSide))return!1;if(0===this.current.tetromino[i][a])return!1;if(0===t&&0===e)return!1}}return!0},i.pasteTetronimo=function(){for(var t=0;t<n.nextSide;t++){var e=this.current.y+t;if(e>=0)for(var o=0;o<n.nextSide;o++)0!==this.current.tetromino[t][o]&&(n.blocks[e][this.current.x+o]=this.current.tetromino[t][o])}};var n={score:{amount:0,halfWidth:0},speed:0,timer:null,paused:!1,pauseText:[{text:"Start!",halfWidth:0},{text:"Paused",halfWidth:0},{text:"Game over!",halfWidth:0}],blocks:[],rows:16,cols:10,nextSide:4};n.xStart=Math.floor((n.cols-n.nextSide)/2),n.yStart=-n.nextSide,n.setGame=function(){t.className+=" tetris",r.node=document.createElement("canvas"),r.node.className="tetrisCanvas",r.node.setAttribute("tabindex","0"),r.node.innerHTML="Your browser does not support the HTML5 canvas tag",t.appendChild(r.node),r.node.setAttribute("width",r.width+"px"),r.node.setAttribute("height",r.height+"px"),r.context=r.node.getContext("2d"),r.context.font="bold 18px Arial";for(var e=0;e<this.pauseText.length;e++)this.pauseText[e].halfWidth=Math.round(r.context.measureText(this.pauseText[e].text).width/2);for(this.score.halfWidth=Math.round(r.context.measureText(0).width/2),e=0;e<this.rows;e++){this.blocks[e]=[];for(var o=0;o<this.cols;o++)this.blocks[e][o]=1}r.drawBackground(),r.drawBlocks(),r.drawNextBlocks(),r.drawPause(0),r.node.focus(),r.node.addEventListener("click",n.resetGame,!1)},n.resetGame=function(){r.node.removeEventListener("click",n.resetGame,!1),r.node.addEventListener("keydown",n.keyPress,!1),r.node.addEventListener("focus",n.focus,!1),r.node.addEventListener("blur",n.blur,!1),n.setScore(0);for(var t=0;t<n.rows;t++)for(var e=0;e<n.cols;e++)n.blocks[t][e]=0;i.chooseNext(),i.chooseNext(),n.speed=1e3,n.timer=setInterval(n.move,n.speed)},n.move=function(){i.move(0,1)||(n.checkScore(),n.checkGameOver())},n.checkScore=function(){var t=0,e=i.current.y+n.nextSide-1;e>=n.rows&&(e=n.rows-1);for(var o=0;o<=n.nextSide;o++){for(var r=!0,s=0;s<n.cols;s++)if(!n.blocks[e][s]){r=!1;break}if(r)t++,this.scoreLine(e);else if(--e<0)break}t>1&&this.addScore(100*t)},n.scoreLine=function(t){for(var e=t;e>0;e--)for(var o=0;o<n.cols;o++)n.blocks[e][o]=n.blocks[e-1][o];this.addScore(100)},n.setScore=function(t){this.score.amount=t,this.score.halfWidth=Math.round(r.context.measureText(t).width/2),r.draw()},n.addScore=function(t){var e=this.score.amount,o=e+t;this.setScore(o),n.speed>100&&Math.floor(o/1e3)>Math.floor(e/1e3)&&(n.speed-=10,clearInterval(this.timer),n.timer=setInterval(n.move,n.speed))},n.checkGameOver=function(){for(var t=0;t<n.cols;t++)if(n.blocks[0][t])return void this.gameOver();i.chooseNext()},n.gameOver=function(){clearInterval(this.timer),r.node.removeEventListener("keydown",n.keyPress,!1),r.node.removeEventListener("focus",n.focus,!1),r.node.removeEventListener("blur",n.blur,!1),n.animateGameOver()},n.animateGameOver=function(){var t=n.rows-1,e=0;!function(){t>=0?(n.blocks[t][e]=1,r.draw(),r.drawPause(2),e+1<n.cols?e++:(e=0,t--),setTimeout(arguments.callee,20)):r.node.addEventListener("click",n.resetGame,!1)}()},n.pause=function(){n.paused?(r.draw(),n.timer=setInterval(n.move,n.speed)):(r.drawPause(1),clearInterval(this.timer)),n.paused=!n.paused},n.focus=function(){n.paused&&(r.node.focus(),n.pause())},$(".tetris-left").on("click",function(){i&&(n.paused||i.move(-1,0))}),$(".tetris-right").on("click",function(){i&&(n.paused||i.move(1,0))}),$(".tetris-rotate").on("click",function(){i&&(n.paused||i.rotate())}),$(".tetris-pause").on("click",function(){i&&(n.paused||n.pause())}),$(".tetris-down").on("click",function(){i&&(n.paused||i.move(0,1))}),n.keyPress=function(t){if(t.preventDefault(),n.paused)80===t.keyCode&&n.pause();else switch(t.keyCode){case 37:i.move(-1,0);break;case 38:i.rotate();break;case 39:i.move(1,0);break;case 40:i.move(0,1);break;case 80:n.pause()}},n.setGame()}(document.getElementById(t))}